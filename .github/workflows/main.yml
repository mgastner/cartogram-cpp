name: Json_to_md

on:
  push:
    branches: [ "main","github-actions-python"]
    paths: ['**.json', '**.geojson']

jobs:
  changes:
    runs-on: ubuntu-latest  
    name: add markdown documentation
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Get changed .json files with paths
        id: changed-json-files-with-paths
        uses: tj-actions/changed-files@v29.0.3 
        with:
          files: |
            *.json
            *.geojson

      - name: Get changed files without paths
        id: changed-json-files-without-paths
        uses: tj-actions/changed-files@v29.0.3 
        with:
          quotepath: "false"
          files: |
            *.json
            *.geojson

      - name: Get changed directory names
        id: changed-directories-of-files
        uses: tj-actions/changed-files@v29.0.3 
        with:
          dir-names: "true"

      - name: List all changed files
        run: |
          for file in ${{ steps.changed-json-files-without-paths.outputs.all_modified_files }}; do
            echo "$file was changed"
          done
      
      - uses: 1arp/create-a-file-action@0.2
        with:
          path: '${{ steps.changed-changed-directories-of-files.outputs.all_modified_files }}'
          file: '${{ steps.changed-json-files-without-paths.outputs.all_modified_files }}.md'
      
      - uses: actions/setup-python@v2
      - uses: BSFishy/pip-action@v1
        with: 
           packages: |
            jsonschema2md
      
      - uses: jannekem/run-python-script-action@v1
        with:
          script: |
            import json
            import jsonschema2md
            
            print(${{ steps.changed-json-files-with-paths.outputs.all_modified_files }}.md)

            parser = jsonschema2md.Parser(
                examples_as_yaml=False,
                show_examples="all",
                )
            with open(${{ steps.changed-json-files-with-paths.outputs.all_modified_files }}) as json_file, open("${{ steps.changed-changed-directories-of-files.outputs.all_modified_files }}.md, 'w') as output_markdown:
                output_md = parser.parse_schema(json.load(json_file))
                output_markdown.writelines(output_md)
      
      - uses: EndBug/add-and-commit@v9.1.0
      
      

